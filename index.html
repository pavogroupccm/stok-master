<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pavo Group | Enterprise ERP</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --primary: #4f46e5; --secondary: #64748b; 
            --success: #10b981; --danger: #ef4444; --warning: #f59e0b; --info: #0ea5e9;
            --bg: #f1f5f9; --card-bg: #ffffff; --text-main: #0f172a; --border: #e2e8f0; 
            --input-bg: #f8fafc; --sidebar-bg: #1e293b;
        }
        [data-theme="dark"] {
            --bg: #0f172a; --card-bg: #1e293b; --text-main: #f1f5f9;
            --border: #334155; --input-bg: #334155; --secondary: #94a3b8; --sidebar-bg: #020617;
        }
        
        * { box-sizing: border-box; outline: none; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text-main); margin: 0; height: 100vh; overflow: hidden; font-size: 14px; }

        /* TOAST */
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
        .toast { background: #333; color: #fff; padding: 12px 20px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); animation: slideIn 0.3s ease; }
        .toast.success { border-left: 5px solid var(--success); }
        .toast.error { border-left: 5px solid var(--danger); }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        /* LAYOUT */
        .wrapper { display: flex; height: 100%; width: 100%; }
        .sidebar { width: 260px; background: var(--sidebar-bg); color: white; padding: 20px; display: flex; flex-direction: column; flex-shrink: 0; overflow-y: auto; }
        .main-container { flex-grow: 1; overflow-y: auto; padding: 25px; position: relative; scroll-behavior: smooth; }
        .brand-logo { width: 100%; max-width: 160px; margin-bottom: 30px; filter: brightness(0) invert(1); display: block; margin-left: auto; margin-right: auto; }
        
        /* NAV */
        .nav-label { font-size: 0.75rem; text-transform: uppercase; color: #64748b; margin: 15px 0 5px 10px; font-weight: 700; letter-spacing: 0.5px; }
        .nav-btn { width: 100%; background: transparent; color: #cbd5e1; padding: 10px; border-radius: 8px; margin-bottom: 2px; cursor: pointer; border: none; text-align: left; font-weight: 500; display: flex; align-items: center; gap: 10px; transition: 0.2s; font-size: 0.9rem; }
        .nav-btn:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }

        /* CARDS & UI */
        .card { background: var(--card-bg); padding: 20px; border-radius: 16px; border: 1px solid var(--border); margin-bottom: 20px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px; }
        input, select, textarea { background: var(--input-bg); color: var(--text-main); padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 0.9rem; width: 100%; transition: 0.2s; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; padding: 12px; color: var(--secondary); border-bottom: 2px solid var(--border); font-size: 0.8rem; text-transform: uppercase; }
        td { padding: 12px; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        
        .btn { padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; display: inline-flex; align-items: center; justify-content: center; gap: 5px; color: #fff; }
        .btn-primary { background: var(--primary); }
        .btn-danger { background: var(--danger); }
        .btn-icon { width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 6px; border: none; cursor: pointer; color: white; }

        /* MODALS & UTILS */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; backdrop-filter: blur(4px); align-items: center; justify-content: center; }
        .modal-content { background: var(--card-bg); width: 90%; max-width: 600px; border-radius: 16px; padding: 25px; max-height: 90vh; overflow-y: auto; position:relative;}
        .close-modal { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--secondary); }

        .tag { padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }
        .tag-Ankara { background: #e0f2fe; color: #0369a1; }
        .tag-Ä°stanbul { background: #fef3c7; color: #92400e; }
        
        .robot-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--input-bg); margin-bottom: 5px; border-radius: 8px; border: 1px solid var(--border); }
        
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .hidden { display: none !important; }
        #login-screen { display: flex; height: 100vh; align-items: center; justify-content: center; background: var(--bg); position: fixed; width: 100%; z-index: 3000; }
        
        /* Dashboard Charts/Bars */
        .progress-container { background: #e2e8f0; height: 10px; border-radius: 5px; overflow: hidden; margin-top: 5px; }
        .progress-bar { height: 100%; background: var(--primary); transition: width 0.5s ease; }
    </style>
</head>
<body data-theme="light">

    <div id="toast-container"></div>

    <div id="login-screen">
        <div class="card" style="width: 100%; max-width: 400px; text-align: center; padding: 40px;">
            <img src="https://www.pavo-group.com/wp-content/uploads/2024/sign/img/logo.png" class="brand-logo" style="filter: invert(0); margin-bottom: 20px;">
            <h2>YÃ¶netim Paneli</h2>
            <p style="color:var(--secondary); margin-bottom:20px">LÃ¼tfen giriÅŸ yapÄ±nÄ±z</p>
            <input type="email" id="email" placeholder="E-Posta" style="margin-bottom: 15px;">
            <input type="password" id="password" placeholder="Åifre" style="margin-bottom: 25px;">
            <button class="btn btn-primary" style="width: 100%;" onclick="login()">GiriÅŸ Yap</button>
        </div>
    </div>

    <div id="app-screen" class="hidden">
        <div class="wrapper">
            <div class="sidebar">
                <img src="https://www.pavo-group.com/wp-content/uploads/2024/sign/img/logo.png" class="brand-logo">
                
                <div class="nav-label">GENEL</div>
                <button class="nav-btn active" onclick="showPage('dashboard-page', this)">ğŸ“Š Dashboard</button>
                <button class="nav-btn" onclick="showPage('calendar-page', this)">ğŸ“… Takvim</button>
                
                <div class="nav-label">OPERASYON</div>
                <button class="nav-btn" onclick="showPage('stok-page', this)">ğŸ“¦ Stok YÃ¶netimi</button>
                <button class="nav-btn" onclick="showPage('fuar-page', this)">ğŸŸï¸ Fuarlar</button>
                
                <div class="nav-label">Ä°LETÄ°ÅÄ°M</div>
                <button class="nav-btn" onclick="showPage('media-page', this)">ğŸ‘¥ Medya CRM</button>
                <button class="nav-btn" onclick="showPage('press-page', this)">ğŸ“° Haber Takip</button>
                <button class="nav-btn" onclick="showPage('content-page', this)">ğŸ“± Ä°Ã§erik PlanÄ±</button>
                
                <div style="margin-top: auto; border-top: 1px solid #334155; padding-top: 10px;">
                    <button class="nav-btn" onclick="toggleTheme()">ğŸŒ“ Tema DeÄŸiÅŸtir</button>
                    <button class="nav-btn" onclick="logout()" style="color: #f87171;">ğŸšª Ã‡Ä±kÄ±ÅŸ Yap</button>
                </div>
            </div>

            <div class="main-container">
                
                <div id="dashboard-page" class="page active">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <h2>Genel BakÄ±ÅŸ</h2>
                        <button class="btn btn-primary" onclick="generatePDF()">ğŸ–¨ï¸ Rapor Al</button>
                    </div>

                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                        <div>
                            <div class="card">
                                <h3>ğŸ’° BÃ¼tÃ§e Durumu</h3>
                                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                                    <span>Harcanan: <b id="bdg-spent">$0</b></span>
                                    <span>Hedef: <b id="bdg-total">$0</b></span>
                                </div>
                                <div class="progress-container">
                                    <div id="bdg-bar" class="progress-bar" style="width:0%"></div>
                                </div>
                                <button class="btn btn-primary" style="margin-top:15px; font-size:0.8rem" onclick="setBudget()">Hedef GÃ¼ncelle</button>
                            </div>

                            <div class="card">
                                <h3>ğŸ“Œ YapÄ±lacaklar Listesi</h3>
                                <div style="display:flex; gap:10px; margin-bottom:10px;">
                                    <input id="todoInput" placeholder="Yeni gÃ¶rev..." style="flex:1">
                                    <button class="btn btn-primary" onclick="addTodo()">+</button>
                                </div>
                                <div id="todo-list" style="max-height: 200px; overflow-y: auto;"></div>
                            </div>
                        </div>

                        <div>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:20px;">
                                <div class="card" style="text-align:center">
                                    <small>Toplam Stok</small>
                                    <h2 id="d-stock" style="margin:5px 0; color:var(--primary)">0</h2>
                                </div>
                                <div class="card" style="text-align:center">
                                    <small>Medya KaydÄ±</small>
                                    <h2 id="d-media" style="margin:5px 0; color:var(--info)">0</h2>
                                </div>
                            </div>
                            
                            <div class="card">
                                <h3>ğŸš¨ YaklaÅŸan Fuarlar (Ä°lk 3)</h3>
                                <div id="dash-upcoming-list">YÃ¼kleniyor...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="calendar-page" class="page">
                    <div class="card">
                        <h3>Etkinlik Takvimi</h3>
                        <div id="calendar"></div>
                    </div>
                </div>

                <div id="stok-page" class="page">
                    <div class="card">
                        <h3>HÄ±zlÄ± ÃœrÃ¼n GiriÅŸi</h3>
                        <div class="form-grid">
                            <input id="pName" placeholder="ÃœrÃ¼n AdÄ±">
                            <select id="pCat"><option>Promosyon</option><option>BasÄ±lÄ± Materyal</option><option>Elektronik</option></select>
                            <select id="pWh"><option>Ankara</option><option>Ä°stanbul</option></select>
                            <input type="number" id="pQty" placeholder="Adet">
                            <button class="btn btn-primary" onclick="addProduct()">Kaydet</button>
                        </div>
                    </div>
                    <div class="card">
                        <div style="margin-bottom:10px">
                            <input id="searchStock" onkeyup="updateStockUI()" placeholder="ÃœrÃ¼n ara..." style="max-width:300px">
                        </div>
                        <table>
                            <thead><tr><th>ÃœrÃ¼n</th><th>Kategori</th><th>Depo</th><th>Adet</th><th style="text-align:right">Ä°ÅŸlem</th></tr></thead>
                            <tbody id="stockBody"></tbody>
                        </table>
                    </div>
                </div>

                <div id="fuar-page" class="page">
                    <div class="card">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <h3>Fuar Listesi</h3>
                            <button class="btn btn-primary" onclick="openModal('fairModal')">+ Yeni Fuar</button>
                        </div>
                        <table>
                            <thead><tr><th>Fuar AdÄ±</th><th>Tarih</th><th>Toplam Maliyet</th><th style="text-align:right">Ä°ÅŸlem</th></tr></thead>
                            <tbody id="fairBody"></tbody>
                        </table>
                    </div>
                </div>

                <div id="media-page" class="page">
                    <div class="card">
                        <h3>Yeni KiÅŸi Ekle</h3>
                        <div class="form-grid">
                            <input id="mName" placeholder="Ad Soyad">
                            <input id="mOutlet" placeholder="Kurum (Ã–rn: AA)">
                            <input id="mEmail" placeholder="E-Posta">
                            <input id="mPhone" placeholder="Telefon">
                            <button class="btn btn-primary" onclick="addMedia()">Kaydet</button>
                        </div>
                    </div>
                    <div class="card">
                        <h3>Medya Listesi</h3>
                        <table>
                            <thead><tr><th>Ä°sim</th><th>Kurum</th><th>Ä°letiÅŸim</th><th style="text-align:right">Sil</th></tr></thead>
                            <tbody id="mediaBody"></tbody>
                        </table>
                    </div>
                </div>

                <div id="press-page" class="page">
                    <div class="card" style="border-left:4px solid var(--info)">
                        <h3>ğŸ¤– Otomatik Haber Tarama</h3>
                        <div style="display:flex; gap:10px">
                            <input id="robotKeyword" value="Pavo Group" style="flex:1">
                            <button class="btn btn-primary" onclick="fetchNews()">ğŸ” Tara ve Getir</button>
                        </div>
                        <div id="robotResults" style="margin-top:15px"></div>
                    </div>
                    <div class="card">
                        <h3>Haber ArÅŸivi</h3>
                        <table>
                            <thead><tr><th>Tarih</th><th>BaÅŸlÄ±k</th><th>Link</th><th style="text-align:right">Sil</th></tr></thead>
                            <tbody id="pressBody"></tbody>
                        </table>
                    </div>
                </div>

                <div id="content-page" class="page">
                    <div class="card">
                        <div style="display:flex; justify-content:space-between">
                            <h3>Sosyal Medya PlanÄ±</h3>
                            <button class="btn btn-primary" onclick="openModal('contentModal')">+ Planla</button>
                        </div>
                        <table>
                            <thead><tr><th>GÃ¶rsel</th><th>Tarih</th><th>Platform</th><th>BaÅŸlÄ±k</th><th style="text-align:right">Ä°ÅŸlem</th></tr></thead>
                            <tbody id="contentBody"></tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="fairModal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('fairModal')">Ã—</button>
            <h3>Fuar Planlama</h3>
            <input type="hidden" id="fEditId">
            <div class="form-grid">
                <div><label>Fuar AdÄ±</label><input id="fName"></div>
                <div><label>Tarih</label><input type="date" id="fDate"></div>
                <div><label>Kira Bedeli ($)</label><input type="number" id="fRent" value="0"></div>
                <div><label>Stant YapÄ±mÄ± ($)</label><input type="number" id="fConst" value="0"></div>
            </div>
            <div style="text-align:right; margin-top:20px;">
                <button class="btn btn-primary" onclick="saveFair()">Kaydet</button>
            </div>
        </div>
    </div>

    <div id="contentModal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('contentModal')">Ã—</button>
            <h3>Ä°Ã§erik DetaylarÄ±</h3>
            <input type="hidden" id="cEditId">
            <div class="form-grid">
                <div><label>BaÅŸlÄ±k</label><input id="cTitle"></div>
                <div><label>Tarih</label><input type="date" id="cDate"></div>
                <div><label>Platform</label><select id="cPlat"><option>LinkedIn</option><option>Instagram</option><option>Twitter</option></select></div>
            </div>
            <div style="margin-top:10px">
                <label>GÃ¶rsel (Opsiyonel)</label>
                <input type="file" onchange="handleImage(this)">
                <img id="preview-image" style="max-height:100px; display:none; margin-top:10px; border-radius:6px;">
            </div>
            <div style="text-align:right; margin-top:20px;">
                <button class="btn btn-primary" onclick="saveContent()">Kaydet</button>
            </div>
        </div>
    </div>

    <script>
        // 1. FIREBASE BAÅLATMA
        const firebaseConfig = {
            apiKey: "AIzaSyAfvTWPkPVQ63T_fTHiYMRnerHkdgqbTr4",
            authDomain: "stokmasterbulut.firebaseapp.com",
            databaseURL: "https://stokmasterbulut-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "stokmasterbulut",
            storageBucket: "stokmasterbulut.firebasestorage.app",
            messagingSenderId: "623117556073",
            appId: "1:623117556073:web:b082fb0567879ac71d45f8"
        };
        
        try {
            firebase.initializeApp(firebaseConfig);
        } catch(e) {
            console.error("Firebase HatasÄ±:", e);
            alert("Firebase baÄŸlantÄ± hatasÄ±. Konsolu kontrol edin.");
        }

        const db = firebase.database();
        const auth = firebase.auth();

        // Veri Modeli
        let data = { inventory:[], fairs:[], media:[], press:[], content:[], todos:[] };
        let currentUser = null;
        let tempImageBase64 = "";
        let budgetGoal = localStorage.getItem('budgetGoal') || 50000;
        let calendarInstance = null;

        // 2. OTURUM KONTROLÃœ
        auth.onAuthStateChanged(u => {
            if(u) {
                currentUser = u;
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('app-screen').classList.remove('hidden');
                showToast("GiriÅŸ BaÅŸarÄ±lÄ±", "success");
                initListeners();
                initCalendar();
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('app-screen').classList.add('hidden');
            }
        });

        function login() {
            const e = document.getElementById('email').value;
            const p = document.getElementById('password').value;
            if(!e || !p) return showToast("E-posta ve ÅŸifre giriniz", "error");
            
            auth.signInWithEmailAndPassword(e, p).catch(err => {
                showToast("Hata: " + err.message, "error");
            });
        }

        function logout() { auth.signOut(); }

        // 3. VERÄ° DÄ°NLEYÄ°CÄ°LERÄ°
        function initListeners() {
            const modules = ['inventory', 'fairs', 'media', 'press', 'content', 'todos'];
            
            modules.forEach(key => {
                db.ref(key).on('value', snapshot => {
                    const val = snapshot.val();
                    data[key] = val ? Object.values(val) : [];
                    updateUI(key);
                    updateDashboard();
                    if(key === 'fairs' || key === 'content') updateCalendarEvents();
                });
            });
        }

        // 4. ARAYÃœZ GÃœNCELLEMELERÄ°
        function updateUI(key) {
            if(key === 'inventory') {
                const b = document.getElementById('stockBody');
                const filter = document.getElementById('searchStock').value.toLowerCase();
                b.innerHTML = '';
                data.inventory.forEach(i => {
                    if(i.name.toLowerCase().includes(filter)) {
                        b.innerHTML += `
                            <tr>
                                <td><b>${i.name}</b></td>
                                <td>${i.cat}</td>
                                <td><span class="tag tag-${i.wh}">${i.wh}</span></td>
                                <td>${i.qty}</td>
                                <td align="right"><button class="btn-icon btn-danger" onclick="delItem('inventory','${i.id}')">ğŸ—‘ï¸</button></td>
                            </tr>`;
                    }
                });
            }
            else if(key === 'fairs') {
                const b = document.getElementById('fairBody');
                b.innerHTML = '';
                data.fairs.forEach(f => {
                    const cost = parseFloat(f.rent||0) + parseFloat(f.const||0);
                    b.innerHTML += `<tr><td>${f.name}</td><td>${f.date}</td><td>$${cost.toLocaleString()}</td><td align="right"><button class="btn-icon btn-danger" onclick="delItem('fairs','${f.id}')">ğŸ—‘ï¸</button></td></tr>`;
                });
            }
            else if(key === 'media') {
                const b = document.getElementById('mediaBody');
                b.innerHTML = '';
                data.media.forEach(m => {
                    b.innerHTML += `<tr><td>${m.name}</td><td>${m.outlet}</td><td>${m.email}<br>${m.phone}</td><td align="right"><button class="btn-icon btn-danger" onclick="delItem('media','${m.id}')">ğŸ—‘ï¸</button></td></tr>`;
                });
            }
            else if(key === 'press') {
                const b = document.getElementById('pressBody');
                b.innerHTML = '';
                data.press.forEach(p => {
                    b.innerHTML += `<tr><td>${p.date}</td><td><a href="${p.link}" target="_blank">${p.title}</a></td><td><a href="${p.link}" target="_blank">ğŸ”—</a></td><td align="right"><button class="btn-icon btn-danger" onclick="delItem('press','${p.id}')">ğŸ—‘ï¸</button></td></tr>`;
                });
            }
            else if(key === 'content') {
                const b = document.getElementById('contentBody');
                b.innerHTML = '';
                data.content.forEach(c => {
                    const img = c.image ? `<img src="${c.image}" style="width:40px;height:40px;object-fit:cover;border-radius:4px">` : 'ğŸ“„';
                    b.innerHTML += `<tr><td>${img}</td><td>${c.date}</td><td>${c.plat}</td><td>${c.title}</td><td align="right"><button class="btn-icon btn-danger" onclick="delItem('content','${c.id}')">ğŸ—‘ï¸</button></td></tr>`;
                });
            }
            else if(key === 'todos') {
                const l = document.getElementById('todo-list');
                l.innerHTML = '';
                data.todos.forEach(t => {
                    l.innerHTML += `
                        <div class="robot-item" style="justify-content:flex-start; gap:10px; cursor:pointer" onclick="delItem('todos','${t.id}')">
                            <div style="width:15px;height:15px;border:2px solid var(--primary);border-radius:3px"></div>
                            <span>${t.text}</span>
                        </div>`;
                });
            }
        }

        function updateDashboard() {
            // Stok SayÄ±sÄ±
            document.getElementById('d-stock').innerText = data.inventory.reduce((a,b) => a + Number(b.qty), 0);
            
            // Medya SayÄ±sÄ±
            document.getElementById('d-media').innerText = data.media.length;

            // BÃ¼tÃ§e
            let spent = 0;
            data.fairs.forEach(f => spent += (parseFloat(f.rent)||0) + (parseFloat(f.const)||0));
            
            const percentage = (spent / budgetGoal) * 100;
            document.getElementById('bdg-spent').innerText = `$${spent.toLocaleString()}`;
            document.getElementById('bdg-total').innerText = `$${parseFloat(budgetGoal).toLocaleString()}`;
            document.getElementById('bdg-bar').style.width = Math.min(percentage, 100) + '%';
            document.getElementById('bdg-bar').style.backgroundColor = percentage > 100 ? 'var(--danger)' : 'var(--primary)';

            // YaklaÅŸanlar
            const list = document.getElementById('dash-upcoming-list');
            list.innerHTML = '';
            if(data.fairs.length === 0) list.innerHTML = '<small style="color:#888">PlanlanmÄ±ÅŸ fuar yok.</small>';
            
            const sortedFairs = [...data.fairs].sort((a,b) => new Date(a.date) - new Date(b.date));
            sortedFairs.slice(0,3).forEach(f => {
                list.innerHTML += `
                    <div class="robot-item">
                        <span style="font-weight:600">${f.name}</span>
                        <span class="tag tag-Ankara">${f.date}</span>
                    </div>`;
            });
        }

        // 5. Ä°ÅLEM FONKSÄ°YONLARI (EKLE/SÄ°L)
        function addProduct() {
            const obj = {
                id: Date.now(),
                name: document.getElementById('pName').value,
                cat: document.getElementById('pCat').value,
                wh: document.getElementById('pWh').value,
                qty: parseInt(document.getElementById('pQty').value) || 0
            };
            if(!obj.name) return showToast('ÃœrÃ¼n adÄ± giriniz', 'error');
            db.ref('inventory/' + obj.id).set(obj).then(() => {
                showToast('ÃœrÃ¼n eklendi', 'success');
                document.getElementById('pName').value = '';
                document.getElementById('pQty').value = '';
            });
        }

        function saveFair() {
            const id = Date.now();
            const obj = {
                id: id,
                name: document.getElementById('fName').value,
                date: document.getElementById('fDate').value,
                rent: document.getElementById('fRent').value,
                const: document.getElementById('fConst').value
            };
            if(!obj.name) return showToast('Fuar adÄ± giriniz', 'error');
            db.ref('fairs/' + id).set(obj);
            closeModal('fairModal');
            showToast('Fuar kaydedildi', 'success');
        }

        function addMedia() {
            const id = Date.now();
            const obj = {
                id: id,
                name: document.getElementById('mName').value,
                outlet: document.getElementById('mOutlet').value,
                email: document.getElementById('mEmail').value,
                phone: document.getElementById('mPhone').value
            };
            if(!obj.name) return;
            db.ref('media/' + id).set(obj);
            showToast('KiÅŸi eklendi', 'success');
            document.getElementById('mName').value = '';
        }

        function addTodo() {
            const val = document.getElementById('todoInput').value;
            if(!val) return;
            db.ref('todos/' + Date.now()).set({ id: Date.now(), text: val });
            document.getElementById('todoInput').value = '';
        }

        function saveContent() {
            const id = Date.now();
            const obj = {
                id: id,
                title: document.getElementById('cTitle').value,
                date: document.getElementById('cDate').value,
                plat: document.getElementById('cPlat').value,
                image: tempImageBase64
            };
            if(!obj.title) return showToast('BaÅŸlÄ±k giriniz', 'error');
            db.ref('content/' + id).set(obj);
            closeModal('contentModal');
            tempImageBase64 = "";
            document.getElementById('preview-image').style.display = 'none';
        }

        function delItem(path, id) {
            if(confirm('Bu kaydÄ± silmek istediÄŸinize emin misiniz?')) {
                db.ref(path + '/' + id).remove();
            }
        }

        // 6. YARDIMCI FONKSÄ°YONLAR
        function showPage(pageId, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(pageId).classList.add('active');
            btn.classList.add('active');

            // Takvim Fix
            if(pageId === 'calendar-page' && calendarInstance) {
                setTimeout(() => calendarInstance.render(), 100);
            }
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        
        function showToast(msg, type) {
            const t = document.createElement('div');
            t.className = `toast ${type}`;
            t.innerText = msg;
            document.getElementById('toast-container').appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }

        function setBudget() {
            const val = prompt("Yeni bÃ¼tÃ§e hedefi ($):", budgetGoal);
            if(val) {
                budgetGoal = val;
                localStorage.setItem('budgetGoal', val);
                updateDashboard();
            }
        }

        function toggleTheme() {
            const body = document.body;
            const current = body.getAttribute('data-theme');
            body.setAttribute('data-theme', current === 'dark' ? 'light' : 'dark');
        }

        // 7. HABER BOTU
        async function fetchNews() {
            const key = document.getElementById('robotKeyword').value;
            const res = document.getElementById('robotResults');
            res.innerHTML = 'AranÄ±yor...';
            
            try {
                const api = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(`https://news.google.com/rss/search?q=${encodeURIComponent(key)}&hl=tr-TR&gl=TR&ceid=TR:tr`)}`;
                const response = await fetch(api);
                const json = await response.json();
                
                res.innerHTML = '';
                json.items.slice(0, 3).forEach(item => {
                    res.innerHTML += `
                        <div class="robot-item">
                            <div style="overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:70%;">
                                <small>${item.pubDate.split(' ')[0]}</small><br>
                                <b>${item.title}</b>
                            </div>
                            <button class="btn-icon btn-primary" onclick="addPressItem('${encodeURIComponent(item.title)}', '${item.link}')">+</button>
                        </div>`;
                });
            } catch(e) {
                res.innerHTML = 'Haber bulunamadÄ±.';
            }
        }

        function addPressItem(title, link) {
            db.ref('press/' + Date.now()).set({
                id: Date.now(),
                title: decodeURIComponent(title),
                link: link,
                date: new Date().toISOString().split('T')[0]
            });
            showToast('Haber arÅŸive eklendi', 'success');
        }

        // 8. RESÄ°M Ä°ÅLEME (Base64)
        function handleImage(input) {
            if(input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    tempImageBase64 = e.target.result;
                    const img = document.getElementById('preview-image');
                    img.src = tempImageBase64;
                    img.style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // 9. TAKVÄ°M YAPILANDIRMASI
        function initCalendar() {
            const el = document.getElementById('calendar');
            calendarInstance = new FullCalendar.Calendar(el, {
                initialView: 'dayGridMonth',
                locale: 'tr',
                height: 500,
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,listWeek'
                },
                events: []
            });
            calendarInstance.render();
        }

        function updateCalendarEvents() {
            if(!calendarInstance) return;
            
            const events = [];
            data.fairs.forEach(f => {
                events.push({ title: 'ğŸŸï¸ ' + f.name, start: f.date, color: '#ef4444' });
            });
            data.content.forEach(c => {
                events.push({ title: 'ğŸ“± ' + c.title, start: c.date, color: '#4f46e5' });
            });
            
            calendarInstance.removeAllEvents();
            calendarInstance.addEventSource(events);
        }

        // 10. PDF RAPOR
        function generatePDF() {
            if(!window.jspdf) return alert("PDF kÃ¼tÃ¼phanesi yÃ¼klenemedi.");
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFont("helvetica", "bold");
            doc.text("Pavo Group - Yonetici Raporu", 14, 20);
            
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            doc.text("Tarih: " + new Date().toLocaleDateString(), 14, 28);
            
            // Ã–zet Tablo
            doc.autoTable({
                startY: 35,
                head: [['Kategori', 'Deger']],
                body: [
                    ['Toplam Stok Adedi', document.getElementById('d-stock').innerText],
                    ['Medya Kisisi', document.getElementById('d-media').innerText],
                    ['Butce Harcamasi', document.getElementById('bdg-spent').innerText],
                    ['Butce Hedefi', document.getElementById('bdg-total').innerText]
                ]
            });

            // Fuarlar
            doc.text("Planlanan Fuarlar", 14, doc.lastAutoTable.finalY + 10);
            const fairRows = data.fairs.map(f => [f.name, f.date, "$"+(parseFloat(f.rent)+parseFloat(f.const))]);
            
            doc.autoTable({
                startY: doc.lastAutoTable.finalY + 15,
                head: [['Fuar Adi', 'Tarih', 'Maliyet']],
                body: fairRows
            });

            doc.save("Pavo_Report.pdf");
        }
    </script>
</body>
</html>
